#! /bin/sh

echo "/* Generated by $0 */"
needcomma=0
types=
echo "typedef const char * res_t;"
echo
while read -r line; do
	[ -z "${line%%#*}" ] && continue # skip comments
	if [ -z "${line%%:*}" ]; then
		[ ${needcomma} -eq 1 ] && printf ",\n\tNULL\n};\n\n"
		type="${line#:}"
		[ "${type}" = "end" ] && break
		printf "static res_t res_%s[] = {\n" "${type}"
		needcomma=0
		types="${types}${types:+ }${type}"
	else
		[ ${needcomma} -eq 1 ] && printf ",\n"
		printf "\t\"%s\"" "${line}"
		needcomma=1
	fi
done

echo "static res_t *res[] = {"
printf "\tNULL,\n"
needcomma=0
for type in ${types}; do
	[ ${needcomma} -eq 1 ] && printf ",\n"
	printf "\tres_%s" "${type}"
	needcomma=1
done
echo
echo "};"
